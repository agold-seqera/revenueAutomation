// Cleanup Daytime Cron Jobs
// Date: September 25, 2025
// Purpose: Remove any daytime/test cron jobs and clean up old ones

System.debug('=== CLEANUP DAYTIME CRON JOBS ===');

// Find all revenue automation related cron jobs
List<CronTrigger> allRevenueCrons = [
    SELECT Id, CronJobDetail.Id, CronJobDetail.Name, CronJobDetail.JobType, 
           CronExpression, TimesTriggered, NextFireTime, PreviousFireTime, State
    FROM CronTrigger 
    WHERE CronJobDetail.Name LIKE '%Revenue%' 
    ORDER BY CronJobDetail.Name
];

System.debug('Found ' + allRevenueCrons.size() + ' revenue automation cron jobs:');

List<String> jobsToDelete = new List<String>();

for (CronTrigger job : allRevenueCrons) {
    System.debug('');
    System.debug('üìã Job: ' + job.CronJobDetail.Name);
    System.debug('   ID: ' + job.Id);
    System.debug('   State: ' + job.State);
    System.debug('   Cron Expression: ' + job.CronExpression);
    System.debug('   Next Fire: ' + job.NextFireTime);
    System.debug('   Times Triggered: ' + job.TimesTriggered);
    
    // Identify jobs to clean up
    String jobName = job.CronJobDetail.Name;
    
    if (jobName.contains('FullValidation_0925') || 
        jobName.contains('MonitoringRun_0923') ||
        jobName.contains('FullValidation_0923') ||
        job.State == 'DELETED') {
        
        System.debug('   üóëÔ∏è  MARKED FOR CLEANUP: ' + jobName);
        jobsToDelete.add(job.Id);
        
    } else if (jobName.contains('Sequential Processing')) {
        System.debug('   ‚úÖ KEEP: Main production job');
    } else {
        System.debug('   ‚ùì REVIEW: Unknown job pattern');
    }
}

System.debug('');
System.debug('üßπ CLEANUP PROCESS:');

// Clean up identified jobs
for (String jobId : jobsToDelete) {
    try {
        System.abortJob(jobId);
        System.debug('   ‚úÖ Aborted job: ' + jobId);
    } catch (Exception e) {
        System.debug('   ‚ö†Ô∏è  Could not abort job ' + jobId + ': ' + e.getMessage());
    }
}

System.debug('');
System.debug('Total jobs cleaned up: ' + jobsToDelete.size());
System.debug('Cleanup complete: ' + System.now());
